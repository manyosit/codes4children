---
import CodeLayout from '../layouts/CodeLayout.astro';
import { getCodeBySlug } from '../data/codes';
const code = getCodeBySlug('emoji')!;
const funFacts = [
  { icon: 'ğŸ“±', text: 'Es gibt Ã¼ber <strong class="text-white">3.600 verschiedene Emojis</strong> â€” genug fÃ¼r tausende Geheimsprachen!' },
  { icon: 'ğŸŒ', text: 'Das Wort "Emoji" kommt aus dem Japanischen: <strong class="text-white">e</strong> (Bild) + <strong class="text-white">moji</strong> (Zeichen).' },
];
---
<CodeLayout code={code} funFacts={funFacts}>
  <!-- Key display -->
  <section class="max-w-content mx-auto px-6 md:px-12 py-16">
    <div class="card-static max-w-4xl mx-auto p-8">
      <h2 class="text-sm font-semibold text-text-secondary uppercase tracking-wider mb-6 text-center">Aktueller SchlÃ¼ssel</h2>
      <div class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-9 lg:grid-cols-13 gap-2" id="emoji-key"></div>
    </div>
  </section>

  <!-- Die Geschichte dahinter -->
  <section class="bg-surface-dark py-16 md:py-20">
    <div class="max-w-content mx-auto px-6 md:px-12">
      <div class="max-w-3xl mx-auto">
        <h2 class="font-display font-bold text-2xl md:text-3xl text-white text-center mb-8">ğŸ“– Die Geschichte dahinter</h2>
        <div class="bg-white/5 backdrop-blur rounded-2xl p-8 border border-white/10">
          <p class="text-gray-300 leading-relaxed mb-4">
            Es ist das Jahr 1999 in <strong class="text-white">Japan</strong>. Der Handydesigner <strong class="text-white">Shigetaka Kurita</strong> hat ein Problem: Japanische Handys kÃ¶nnen nur winzige Textnachrichten anzeigen. Wie soll man da GefÃ¼hle ausdrÃ¼cken? Ein "Ich bin glÃ¼cklich" verbraucht so viele Zeichen!
          </p>
          <p class="text-gray-300 leading-relaxed mb-4">
            Kurita hat eine geniale Idee: Was, wenn ein einziges kleines Bild ein ganzes GefÃ¼hl ersetzen kÃ¶nnte? Er setzt sich hin und zeichnet <strong class="text-white">176 winzige Bildchen</strong> â€” jeweils nur 12Ã—12 Pixel groÃŸ. Herzen, Smileys, Wetter-Symbole, Tiere. Er nennt sie <strong class="text-white">Emoji</strong> â€” zusammengesetzt aus den japanischen WÃ¶rtern "e" (Bild) und "moji" (Zeichen).
          </p>
          <p class="text-gray-300 leading-relaxed mb-4">
            Die Japaner sind begeistert! Bald will jedes Handy Emojis haben. Und als Apple 2011 Emojis auf das iPhone bringt, erobern sie die ganze Welt. Heute gibt es Ã¼ber <strong class="text-white">3.600 verschiedene Emojis</strong> â€” und jedes Jahr kommen neue dazu.
          </p>
          <p class="text-gray-300 leading-relaxed">
            Aber hier kommt der Clou: Wenn du jedem Buchstaben ein bestimmtes Emoji zuordnest, hast du deine eigene, persÃ¶nliche Geheimsprache â€” und die kann wirklich <strong class="text-white">niemand</strong> knacken, der deinen SchlÃ¼ssel nicht kennt! ğŸ¤«
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Tool -->
  <section class="py-16" style={`background: ${code.accentColor}08`}>
    <div class="max-w-3xl mx-auto px-6 md:px-12">
      <h2 class="font-display font-bold text-2xl md:text-3xl text-center mb-10">Emoji-Ãœbersetzer</h2>
      <div class="card-static p-8">
        <!-- Emoji set selection -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-text-primary mb-3">Emoji-Set</label>
          <div class="flex flex-wrap gap-2">
            <button class="emoji-set-btn btn text-sm !px-4 !py-2 !min-h-0" style={`background: ${code.accentColor}`} data-set="animals">ğŸ± Tiere</button>
            <button class="emoji-set-btn btn text-sm !px-4 !py-2 !min-h-0 bg-pink-500" data-set="food">ğŸ• Essen</button>
            <button class="emoji-set-btn btn text-sm !px-4 !py-2 !min-h-0 bg-blue-500" data-set="space">ğŸš€ Weltraum</button>
            <button class="emoji-set-btn btn text-sm !px-4 !py-2 !min-h-0 bg-green-500" data-set="nature">ğŸŒ¸ Natur</button>
            <button class="emoji-set-btn btn text-sm !px-4 !py-2 !min-h-0 bg-primary" data-set="faces">ğŸ˜€ Gesichter</button>
          </div>
        </div>

        <div class="mb-6">
          <label class="block text-sm font-semibold text-text-primary mb-2">Deine Nachricht</label>
          <input type="text" id="emoji-input" placeholder="Schreibe hier..." class="tool-input" maxlength="50" />
        </div>

        <div class="flex gap-3 mb-8 flex-wrap">
          <button id="btn-to-emoji" class="btn" style={`background: ${code.accentColor}`}>In Emojis</button>
          <button id="btn-from-emoji" class="btn bg-primary">EntschlÃ¼sseln</button>
          <button id="btn-shuffle" class="btn bg-code-caesar">ğŸ”€ Mischen</button>
        </div>

        <div>
          <label class="block text-sm font-semibold text-text-secondary mb-2">Ergebnis</label>
          <div id="emoji-output" class="tool-output text-3xl text-center tracking-wider"
               style={`background: ${code.accentColor}10; border-left: 4px solid ${code.accentColor}`}>â€¦</div>
        </div>

        <button id="btn-copy" class="mt-4 text-sm px-4 py-2 rounded-xl border-2 border-gray-200 text-text-secondary hover:bg-gray-50 transition-colors">
          ğŸ“‹ Kopieren
        </button>
      </div>
    </div>
  </section>

  <!-- Tips -->
  <section class="max-w-content mx-auto px-6 md:px-12 py-16">
    <div class="card-static max-w-3xl mx-auto p-8">
      <h2 class="font-display font-bold text-2xl mb-6">Tipps fÃ¼r Profis</h2>
      <div class="space-y-3 text-text-secondary">
        <p>ğŸ“± Schicke Emoji-Nachrichten Ã¼ber WhatsApp â€” niemand weiÃŸ, was sie bedeuten.</p>
        <p>ğŸ“ Schreibe den SchlÃ¼ssel auf und gib ihn nur deinen besten Freunden.</p>
        <p>ğŸ”„ Wechsle den SchlÃ¼ssel regelmÃ¤ÃŸig fÃ¼r extra Sicherheit.</p>
        <p>ğŸ”€ Nutze â€Mischen" fÃ¼r einen einzigartigen, zufÃ¤lligen SchlÃ¼ssel.</p>
      </div>
    </div>
  </section>

  <script define:vars={{ accentColor: code.accentColor, accentColorLight: code.accentColorLight }}>
    const ALPHA = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const emojiSets = {
      animals: ['ğŸ±','ğŸ¶','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¯','ğŸ¦','ğŸ®','ğŸ·','ğŸ¸','ğŸµ','ğŸ”','ğŸ§','ğŸ¦','ğŸ¤','ğŸ¦‹','ğŸŒ','ğŸ›','ğŸ','ğŸ','ğŸ¦„','ğŸ¢'],
      food: ['ğŸ','ğŸ','ğŸŠ','ğŸ‹','ğŸŒ','ğŸ‰','ğŸ‡','ğŸ“','ğŸ«','ğŸ’','ğŸ¥','ğŸ•','ğŸŒ®','ğŸ”','ğŸŒ­','ğŸ©','ğŸ§','ğŸª','ğŸ«','ğŸ¿','ğŸ¥¨','ğŸ¥•','ğŸŒ½','ğŸ„','ğŸ¥‘','ğŸ°'],
      space: ['ğŸš€','ğŸŒ','ğŸŒ™','â­','ğŸŒŸ','ğŸ’«','â˜„ï¸','ğŸª','ğŸŒ','ğŸŒ›','ğŸŒ ','ğŸ”­','ğŸ‘½','ğŸ›¸','ğŸŒŒ','âœ¨','ğŸŒˆ','âš¡','ğŸ”¥','ğŸ’','ğŸ†','ğŸŒŠ','â„ï¸','ğŸŒªï¸','â˜€ï¸','ğŸŒ‘'],
      nature: ['ğŸŒ¸','ğŸŒº','ğŸŒ»','ğŸŒ¹','ğŸŒ·','ğŸŒ¼','ğŸ€','ğŸŒ¿','ğŸƒ','ğŸŒ´','ğŸŒµ','ğŸ','ğŸ‚','ğŸŒ¾','ğŸ‹','ğŸ','ğŸª»','ğŸª·','ğŸŒ±','ğŸª´','ğŸ„','ğŸŒ²','ğŸŒ³','ğŸª¨','ğŸ’','ğŸŒ'],
      faces: ['ğŸ˜€','ğŸ˜ƒ','ğŸ˜„','ğŸ˜','ğŸ˜†','ğŸ˜…','ğŸ¤£','ğŸ˜‚','ğŸ™‚','ğŸ˜‰','ğŸ˜Š','ğŸ˜‡','ğŸ¥°','ğŸ˜','ğŸ¤©','ğŸ˜˜','ğŸ˜‹','ğŸ˜›','ğŸ¤”','ğŸ¤—','ğŸ¤«','ğŸ˜','ğŸ¥³','ğŸ˜','ğŸ˜Œ','ğŸ¤“'],
    };

    let currentEmojis = [...emojiSets.animals];

    function updateKeyDisplay() {
      document.getElementById('emoji-key').innerHTML = ALPHA.split('').map((l, i) =>
        `<div class="rounded-xl p-2.5 text-center" style="background:${accentColorLight}">
          <div class="text-sm font-bold text-gray-800">${l}</div>
          <div class="text-xl">${currentEmojis[i]}</div>
        </div>`
      ).join('');
    }

    document.querySelectorAll('.emoji-set-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentEmojis = [...emojiSets[btn.dataset.set]];
        updateKeyDisplay();
      });
    });

    document.getElementById('btn-shuffle').addEventListener('click', () => {
      for (let i = currentEmojis.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [currentEmojis[i], currentEmojis[j]] = [currentEmojis[j], currentEmojis[i]];
      }
      updateKeyDisplay();
    });

    document.getElementById('btn-to-emoji').addEventListener('click', () => {
      const text = document.getElementById('emoji-input').value.toUpperCase();
      const result = text.split('').map(c => {
        if (c === ' ') return '  ';
        const i = ALPHA.indexOf(c);
        return i >= 0 ? currentEmojis[i] : c;
      }).join('');
      document.getElementById('emoji-output').textContent = result || 'â€¦';
    });

    document.getElementById('btn-from-emoji').addEventListener('click', () => {
      const text = document.getElementById('emoji-input').value;
      const result = [...text].map(c => {
        if (c === ' ') return ' ';
        const i = currentEmojis.indexOf(c);
        return i >= 0 ? ALPHA[i] : c;
      }).join('');
      document.getElementById('emoji-output').textContent = result || 'â€¦';
    });

    document.getElementById('btn-copy').addEventListener('click', () => {
      const text = document.getElementById('emoji-output').textContent || '';
      navigator.clipboard.writeText(text);
      const btn = document.getElementById('btn-copy');
      btn.textContent = 'âœ… Kopiert!';
      setTimeout(() => btn.textContent = 'ğŸ“‹ Kopieren', 2000);
    });

    updateKeyDisplay();
  </script>
</CodeLayout>
