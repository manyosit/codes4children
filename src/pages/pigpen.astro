---
import CodeLayout from '../layouts/CodeLayout.astro';
import { getCodeBySlug } from '../data/codes';
const code = getCodeBySlug('pigpen')!;
const funFacts = [
  { icon: 'üèõÔ∏è', text: 'Die <strong class="text-white">Freimaurer</strong> nutzten diese Chiffre im 18. Jahrhundert f√ºr ihre geheimen Botschaften.' },
  { icon: 'üìú', text: 'In der TV-Serie <strong class="text-white">Gravity Falls</strong> werden Pigpen-Symbole als Easter Eggs versteckt.' },
];
---
<CodeLayout code={code} funFacts={funFacts}>
  <!-- Grids -->
  <section class="max-w-content mx-auto px-6 md:px-12 py-16">
    <div class="card-static max-w-4xl mx-auto p-8">
      <h2 class="font-display font-bold text-2xl mb-4">Das Geheimnis der Gitter</h2>
      <p class="text-text-secondary mb-8">Die Buchstaben sitzen in Gittern. Jeder Buchstabe wird durch die Linien um ihn herum dargestellt.</p>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="rounded-xl p-6 text-center" style={`background: ${code.accentColorLight}`}>
          <h3 class="font-semibold text-sm text-text-secondary mb-4">Gitter 1 ¬∑ ohne Punkt</h3>
          <svg viewBox="0 0 180 180" class="w-40 h-40 mx-auto">
            <line x1="60" y1="0" x2="60" y2="180" stroke={code.accentColor} stroke-width="2.5" opacity="0.6"/>
            <line x1="120" y1="0" x2="120" y2="180" stroke={code.accentColor} stroke-width="2.5" opacity="0.6"/>
            <line x1="0" y1="60" x2="180" y2="60" stroke={code.accentColor} stroke-width="2.5" opacity="0.6"/>
            <line x1="0" y1="120" x2="180" y2="120" stroke={code.accentColor} stroke-width="2.5" opacity="0.6"/>
            <text x="30" y="40" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">A</text>
            <text x="90" y="40" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">B</text>
            <text x="150" y="40" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">C</text>
            <text x="30" y="100" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">D</text>
            <text x="90" y="100" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">E</text>
            <text x="150" y="100" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">F</text>
            <text x="30" y="160" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">G</text>
            <text x="90" y="160" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">H</text>
            <text x="150" y="160" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">I</text>
          </svg>
        </div>
        <div class="rounded-xl p-6 text-center bg-pink-50">
          <h3 class="font-semibold text-sm text-text-secondary mb-4">Gitter 2 ¬∑ mit Punkt</h3>
          <svg viewBox="0 0 180 180" class="w-40 h-40 mx-auto">
            <line x1="60" y1="0" x2="60" y2="180" stroke="#EC4899" stroke-width="2.5" opacity="0.6"/>
            <line x1="120" y1="0" x2="120" y2="180" stroke="#EC4899" stroke-width="2.5" opacity="0.6"/>
            <line x1="0" y1="60" x2="180" y2="60" stroke="#EC4899" stroke-width="2.5" opacity="0.6"/>
            <line x1="0" y1="120" x2="180" y2="120" stroke="#EC4899" stroke-width="2.5" opacity="0.6"/>
            <text x="30" y="38" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">J</text>
            <text x="90" y="38" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">K</text>
            <text x="150" y="38" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">L</text>
            <text x="30" y="98" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">M</text>
            <text x="90" y="98" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">N</text>
            <text x="150" y="98" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">O</text>
            <text x="30" y="158" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">P</text>
            <text x="90" y="158" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">Q</text>
            <text x="150" y="158" text-anchor="middle" font-size="22" font-weight="600" fill="#0F172A">R</text>
            <circle cx="30" cy="50" r="3" fill="#EC4899"/><circle cx="90" cy="50" r="3" fill="#EC4899"/><circle cx="150" cy="50" r="3" fill="#EC4899"/>
            <circle cx="30" cy="110" r="3" fill="#EC4899"/><circle cx="90" cy="110" r="3" fill="#EC4899"/><circle cx="150" cy="110" r="3" fill="#EC4899"/>
            <circle cx="30" cy="170" r="3" fill="#EC4899"/><circle cx="90" cy="170" r="3" fill="#EC4899"/><circle cx="150" cy="170" r="3" fill="#EC4899"/>
          </svg>
        </div>
      </div>
    </div>
  </section>

  <!-- Tool -->
  <section class="py-16" style={`background: ${code.accentColor}08`}>
    <div class="max-w-3xl mx-auto px-6 md:px-12">
      <h2 class="font-display font-bold text-2xl md:text-3xl text-center mb-10">Pigpen-√úbersetzer</h2>
      <div class="card-static p-8">
        <div class="mb-6">
          <label class="block text-sm font-semibold text-text-primary mb-2">Dein Text</label>
          <input type="text" id="pigpen-input" placeholder="Schreibe hier..." class="tool-input" maxlength="30" />
        </div>
        <button id="btn-pigpen" class="btn mb-8" style={`background: ${code.accentColor}`}>Umwandeln</button>
        <div>
          <label class="block text-sm font-semibold text-text-secondary mb-2">Geheimschrift</label>
          <div id="pigpen-output" class="bg-white border-2 border-gray-100 rounded-xl p-6 min-h-[80px] flex flex-wrap gap-2 items-center justify-center">
            <span class="text-gray-300 text-sm">Hier erscheinen die Symbole‚Ä¶</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="max-w-content mx-auto px-6 md:px-12 py-16">
    <div class="card-static max-w-3xl mx-auto text-center p-8">
      <h2 class="font-display font-bold text-2xl mb-4">üèÜ Herausforderung</h2>
      <p class="text-text-secondary">Schreibe deinen Namen in Pigpen-Schrift auf Papier und gib ihn einem Freund zum Entschl√ºsseln.</p>
    </div>
  </section>

  <script define:vars={{ accentColor: code.accentColor }}>
    function drawPigpen(letter) {
      const s = 48, m = 6;
      const shapes = {
        'A': {path: `M${m} ${s-m} L${m} ${m} L${s-m} ${m}`, dot: false},
        'B': {path: `M${m} ${m} L${s-m} ${m}`, dot: false},
        'C': {path: `M${m} ${m} L${s-m} ${m} L${s-m} ${s-m}`, dot: false},
        'D': {path: `M${m} ${s-m} L${m} ${m}`, dot: false},
        'E': {path: `M${m} ${m} L${s-m} ${m} L${s-m} ${s-m} L${m} ${s-m} Z`, dot: false},
        'F': {path: `M${s-m} ${m} L${s-m} ${s-m}`, dot: false},
        'G': {path: `M${m} ${m} L${m} ${s-m} L${s-m} ${s-m}`, dot: false},
        'H': {path: `M${m} ${s-m} L${s-m} ${s-m}`, dot: false},
        'I': {path: `M${s-m} ${m} L${s-m} ${s-m} L${m} ${s-m}`, dot: false},
        'J': {path: `M${m} ${s-m} L${m} ${m} L${s-m} ${m}`, dot: true},
        'K': {path: `M${m} ${m} L${s-m} ${m}`, dot: true},
        'L': {path: `M${m} ${m} L${s-m} ${m} L${s-m} ${s-m}`, dot: true},
        'M': {path: `M${m} ${s-m} L${m} ${m}`, dot: true},
        'N': {path: `M${m} ${m} L${s-m} ${m} L${s-m} ${s-m} L${m} ${s-m} Z`, dot: true},
        'O': {path: `M${s-m} ${m} L${s-m} ${s-m}`, dot: true},
        'P': {path: `M${m} ${m} L${m} ${s-m} L${s-m} ${s-m}`, dot: true},
        'Q': {path: `M${m} ${s-m} L${s-m} ${s-m}`, dot: true},
        'R': {path: `M${s-m} ${m} L${s-m} ${s-m} L${m} ${s-m}`, dot: true},
        'S': {path: `M${s/2} ${m} L${s-m} ${s/2} L${s/2} ${s-m}`, dot: false},
        'T': {path: `M${s/2} ${m} L${m} ${s/2} L${s/2} ${s-m}`, dot: false},
        'U': {path: `M${m} ${s/2} L${s/2} ${m} L${s-m} ${s/2}`, dot: false},
        'V': {path: `M${m} ${s/2} L${s/2} ${s-m} L${s-m} ${s/2}`, dot: false},
        'W': {path: `M${s/2} ${m} L${s-m} ${s/2} L${s/2} ${s-m}`, dot: true},
        'X': {path: `M${s/2} ${m} L${m} ${s/2} L${s/2} ${s-m}`, dot: true},
        'Y': {path: `M${m} ${s/2} L${s/2} ${m} L${s-m} ${s/2}`, dot: true},
        'Z': {path: `M${m} ${s/2} L${s/2} ${s-m} L${s-m} ${s/2}`, dot: true},
      };
      const shape = shapes[letter];
      if (!shape) return '';
      let svg = `<svg viewBox="0 0 ${s} ${s}" width="${s}" height="${s}" class="inline-block">`;
      svg += `<path d="${shape.path}" fill="none" stroke="${accentColor}" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>`;
      if (shape.dot) svg += `<circle cx="${s/2}" cy="${s/2}" r="3.5" fill="#EC4899"/>`;
      svg += '</svg>';
      return svg;
    }

    document.getElementById('btn-pigpen').addEventListener('click', () => {
      const text = document.getElementById('pigpen-input').value.toUpperCase();
      const output = document.getElementById('pigpen-output');
      if (!text) { output.innerHTML = '<span class="text-gray-300 text-sm">Schreibe erst etwas‚Ä¶</span>'; return; }
      output.innerHTML = text.split('').map(c => {
        if (c === ' ') return '<span class="w-4"></span>';
        return drawPigpen(c);
      }).join('');
    });
  </script>
</CodeLayout>
