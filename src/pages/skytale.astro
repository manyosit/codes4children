---
import Layout from '../layouts/Layout.astro';
---
<Layout title="Skytale" emoji="ğŸ“œ">
  <section class="section text-center max-w-3xl mx-auto px-6 pb-12">
    <div class="text-6xl mb-6 animate-fade-in">ğŸ“œ</div>
    <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-4">
      <span class="gradient-text">Skytale</span>
    </h1>
    <p class="text-lg text-gray-500 max-w-xl mx-auto">
      Die Spartaner wickelten einen Papierstreifen um einen Stock und schrieben quer darÃ¼ber. Ohne den passenden Stock â€” nur Buchstabensalat.
    </p>
  </section>

  <!-- Steps -->
  <section class="max-w-3xl mx-auto px-6 mb-16">
    <div class="card">
      <h2 class="text-2xl font-bold mb-6">So funktioniert's</h2>
      <div class="space-y-4">
        <div class="flex items-start gap-4 bg-pastel-purple rounded-2xl p-5">
          <span class="text-sm font-bold bg-apple-purple text-white w-8 h-8 rounded-full flex items-center justify-center shrink-0">1</span>
          <p class="text-gray-600">Wickle einen Papierstreifen spiralfÃ¶rmig um einen Stock.</p>
        </div>
        <div class="flex items-start gap-4 bg-pastel-indigo rounded-2xl p-5">
          <span class="text-sm font-bold bg-apple-indigo text-white w-8 h-8 rounded-full flex items-center justify-center shrink-0">2</span>
          <p class="text-gray-600">Schreibe deine Nachricht quer Ã¼ber den Streifen.</p>
        </div>
        <div class="flex items-start gap-4 bg-pastel-blue rounded-2xl p-5">
          <span class="text-sm font-bold bg-apple-blue text-white w-8 h-8 rounded-full flex items-center justify-center shrink-0">3</span>
          <p class="text-gray-600">Abgewickelt sieht die Nachricht aus wie Buchstabensalat.</p>
        </div>
        <div class="flex items-start gap-4 bg-pastel-green rounded-2xl p-5">
          <span class="text-sm font-bold bg-apple-green text-white w-8 h-8 rounded-full flex items-center justify-center shrink-0">4</span>
          <p class="text-gray-600">Nur wer einen Stock gleicher Dicke hat, kann die Nachricht lesen.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Tool -->
  <section class="bg-pastel-gray py-16">
    <div class="max-w-3xl mx-auto px-6">
      <h2 class="text-2xl md:text-3xl font-bold text-center mb-10">Skytale-Simulator</h2>
      <div class="bg-white rounded-3xl p-8 shadow-soft">
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Deine Nachricht</label>
          <input type="text" id="skytale-input" placeholder="Schreibe hier..." class="tool-input" maxlength="60" />
        </div>
        <div class="mb-8">
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Stockbreite: <span id="cols-display" class="text-apple-purple">4</span>
          </label>
          <input type="range" id="skytale-cols" min="2" max="10" value="4" />
        </div>
        <div class="flex gap-3 mb-8 flex-wrap">
          <button id="btn-encrypt-sky" class="btn btn-purple">VerschlÃ¼sseln</button>
          <button id="btn-decrypt-sky" class="btn btn-indigo">EntschlÃ¼sseln</button>
        </div>
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-400 mb-2">Auf dem Stock</label>
          <div id="skytale-grid" class="bg-pastel-gray rounded-2xl p-4 flex flex-wrap gap-1 justify-center min-h-[60px]"></div>
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-400 mb-2">Ergebnis</label>
          <div id="skytale-output" class="tool-output text-xl font-mono font-semibold text-apple-purple text-center">â€¦</div>
        </div>
      </div>
    </div>
  </section>

  <!-- DIY -->
  <section class="section max-w-3xl mx-auto px-6">
    <div class="card">
      <h2 class="text-2xl font-bold mb-6">Bastle deine eigene Skytale</h2>
      <div class="space-y-3 text-gray-500">
        <p>ğŸ“¦ <strong class="text-gray-900">Du brauchst:</strong> Einen runden Stock und einen langen Papierstreifen</p>
        <p>âœ‚ï¸ Schneide einen Streifen (ca. 2 cm breit, 30 cm lang)</p>
        <p>ğŸ”„ Wickle ihn eng um den Stock</p>
        <p>âœï¸ Schreibe deine Nachricht quer Ã¼ber die Windungen</p>
        <p>ğŸ Schicke den Streifen an einen Freund â€” nur mit dem gleichen Stock lesbar!</p>
      </div>
    </div>
  </section>

  <script>
    const input = document.getElementById('skytale-input') as HTMLInputElement;
    const colsSlider = document.getElementById('skytale-cols') as HTMLInputElement;
    const colsDisplay = document.getElementById('cols-display')!;
    const grid = document.getElementById('skytale-grid')!;
    const output = document.getElementById('skytale-output')!;

    colsSlider.addEventListener('input', () => { colsDisplay.textContent = colsSlider.value; });

    const pastelColors = ['bg-pastel-purple','bg-pastel-indigo','bg-pastel-blue','bg-pastel-green','bg-pastel-orange','bg-pastel-pink','bg-pastel-yellow'];

    function encrypt(text: string, cols: number) {
      const clean = text.toUpperCase().replace(/[^A-ZÃ„Ã–ÃœÃŸ ]/g, '');
      const rows = Math.ceil(clean.length / cols);
      const padded = clean.padEnd(rows * cols, 'Â·');
      const g: string[][] = [];
      for (let r = 0; r < rows; r++) g.push(padded.slice(r * cols, (r+1) * cols).split(''));
      let result = '';
      for (let c = 0; c < cols; c++) for (let r = 0; r < rows; r++) result += g[r][c];
      return { grid: g, result };
    }

    function decrypt(text: string, cols: number) {
      const clean = text.toUpperCase();
      const rows = Math.ceil(clean.length / cols);
      const padded = clean.padEnd(rows * cols, 'Â·');
      const g: string[][] = Array.from({length: rows}, () => Array(cols).fill('Â·'));
      let idx = 0;
      for (let c = 0; c < cols; c++) for (let r = 0; r < rows; r++) g[r][c] = padded[idx++] || 'Â·';
      let result = '';
      for (let r = 0; r < rows; r++) result += g[r].join('');
      return { grid: g, result: result.replace(/Â·/g, '').trim() };
    }

    function showGrid(g: string[][], cols: number) {
      grid.style.cssText = `display:grid;grid-template-columns:repeat(${cols},1fr);max-width:${cols*3.5}rem;margin:0 auto;`;
      grid.innerHTML = g.map((row, ri) =>
        row.map(c => `<div class="${pastelColors[ri % pastelColors.length]} rounded-lg p-2 text-center font-mono font-semibold text-sm">${c}</div>`).join('')
      ).join('');
    }

    document.getElementById('btn-encrypt-sky')!.addEventListener('click', () => {
      const cols = parseInt(colsSlider.value);
      const { grid: g, result } = encrypt(input.value, cols);
      showGrid(g, cols);
      output.textContent = result;
    });
    document.getElementById('btn-decrypt-sky')!.addEventListener('click', () => {
      const cols = parseInt(colsSlider.value);
      const { grid: g, result } = decrypt(input.value, cols);
      showGrid(g, cols);
      output.textContent = result;
    });
  </script>
</Layout>
