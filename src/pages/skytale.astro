---
import Layout from '../layouts/Layout.astro';
---
<Layout title="Skytale" emoji="ğŸ“œ">
  <div class="text-center mb-8">
    <div class="text-7xl mb-4">ğŸ“œ</div>
    <h1 class="text-5xl font-fun font-bold rainbow-text">Skytale</h1>
    <p class="text-xl text-gray-600 mt-4 max-w-2xl mx-auto">
      Die Spartaner im antiken Griechenland benutzten einen Stock und einen Lederstreifen,
      um geheime Nachrichten zu verschlÃ¼sseln. Genial einfach! âš”ï¸
    </p>
  </div>

  <!-- How it works -->
  <div class="bg-white rounded-3xl p-8 shadow-xl mb-8">
    <h2 class="text-3xl font-fun font-bold text-candy-red mb-4">ğŸ“– So funktioniert's</h2>
    <div class="space-y-4 text-lg">
      <div class="flex items-start gap-4 bg-candy-red/10 rounded-2xl p-4">
        <span class="text-3xl">1ï¸âƒ£</span>
        <p>Wickle einen <strong>Papierstreifen</strong> spiralfÃ¶rmig um einen Stock.</p>
      </div>
      <div class="flex items-start gap-4 bg-candy-orange/10 rounded-2xl p-4">
        <span class="text-3xl">2ï¸âƒ£</span>
        <p>Schreibe deine Nachricht <strong>quer Ã¼ber den Streifen</strong>, ein Buchstabe pro Windung.</p>
      </div>
      <div class="flex items-start gap-4 bg-candy-yellow/10 rounded-2xl p-4">
        <span class="text-3xl">3ï¸âƒ£</span>
        <p>Wenn du den Streifen abwickelst, sieht die Nachricht wie <strong>Buchstabensalat</strong> aus!</p>
      </div>
      <div class="flex items-start gap-4 bg-candy-green/10 rounded-2xl p-4">
        <span class="text-3xl">4ï¸âƒ£</span>
        <p>Nur wer einen <strong>Stock gleicher Dicke</strong> hat, kann die Nachricht lesen!</p>
      </div>
    </div>
  </div>

  <!-- Visual example -->
  <div class="bg-gradient-to-br from-candy-red/20 to-orange-200/30 rounded-3xl p-8 shadow-xl mb-8">
    <h2 class="text-3xl font-fun font-bold text-candy-red mb-4">ğŸ‘€ Beispiel</h2>
    <p class="text-lg mb-4">Nachricht: <strong>"HALLO WELT"</strong> mit Stockbreite 3:</p>

    <div class="bg-white rounded-2xl p-6 mb-4">
      <p class="font-bold mb-2">Auf dem Stock liest man:</p>
      <div class="font-mono text-xl grid grid-cols-4 gap-1 max-w-xs mx-auto text-center">
        <div class="bg-candy-red/20 rounded p-2 font-bold">H</div>
        <div class="bg-candy-red/20 rounded p-2 font-bold">A</div>
        <div class="bg-candy-red/20 rounded p-2 font-bold">L</div>
        <div class="bg-candy-red/20 rounded p-2 font-bold">L</div>
        <div class="bg-candy-orange/20 rounded p-2 font-bold">O</div>
        <div class="bg-candy-orange/20 rounded p-2 font-bold">W</div>
        <div class="bg-candy-orange/20 rounded p-2 font-bold">E</div>
        <div class="bg-candy-orange/20 rounded p-2 font-bold">L</div>
        <div class="bg-candy-yellow/20 rounded p-2 font-bold">T</div>
        <div class="bg-gray-100 rounded p-2">Â·</div>
        <div class="bg-gray-100 rounded p-2">Â·</div>
        <div class="bg-gray-100 rounded p-2">Â·</div>
      </div>
      <p class="font-bold mt-4 mb-2">Abgewickelt (verschlÃ¼sselt):</p>
      <p class="text-3xl font-mono text-center text-candy-red font-bold">HOTELAWLÂ·LÂ·EÂ·</p>
      <p class="text-sm text-gray-500 text-center mt-1">(Man liest Spalte fÃ¼r Spalte statt Zeile fÃ¼r Zeile)</p>
    </div>
  </div>

  <!-- Interactive Tool -->
  <div class="bg-gradient-to-br from-candy-red/20 to-rose-200/30 rounded-3xl p-8 shadow-xl mb-8">
    <h2 class="text-3xl font-fun font-bold text-candy-red mb-6">ğŸ”§ Skytale-Simulator</h2>

    <div class="mb-6">
      <label class="block text-lg font-bold mb-2">ğŸ“ Deine Nachricht:</label>
      <input type="text" id="skytale-input" placeholder="Schreibe hier..." class="tool-input" maxlength="60" />
    </div>

    <div class="mb-6">
      <label class="block text-lg font-bold mb-2">ğŸ“ Stockbreite (Spalten): <span id="cols-display" class="text-candy-red text-2xl">4</span></label>
      <input type="range" id="skytale-cols" min="2" max="10" value="4"
             class="w-full h-3 rounded-full appearance-none bg-candy-red/30 cursor-pointer" />
    </div>

    <div class="flex gap-4 mb-6 flex-wrap">
      <button id="btn-encrypt-sky" class="btn-fun bg-gradient-to-r from-candy-red to-orange-400">
        ğŸ”’ VerschlÃ¼sseln
      </button>
      <button id="btn-decrypt-sky" class="btn-fun bg-gradient-to-r from-candy-purple to-candy-pink">
        ğŸ”“ EntschlÃ¼sseln
      </button>
    </div>

    <!-- Grid view -->
    <div class="mb-4">
      <label class="block text-lg font-bold mb-2">ğŸ“Š Auf dem Stock:</label>
      <div id="skytale-grid" class="flex flex-wrap gap-1 justify-center bg-white rounded-2xl p-4"></div>
    </div>

    <div>
      <label class="block text-lg font-bold mb-2">âœ¨ Ergebnis:</label>
      <div id="skytale-output" class="tool-output text-2xl font-mono font-bold text-candy-red text-center">...</div>
    </div>
  </div>

  <!-- DIY -->
  <div class="bg-gradient-to-r from-candy-green/20 to-candy-blue/20 rounded-3xl p-8 shadow-xl">
    <h2 class="text-3xl font-fun font-bold text-candy-green mb-4">ğŸ› ï¸ Bastle deine eigene Skytale!</h2>
    <div class="space-y-3 text-lg">
      <p>ğŸ“¦ <strong>Du brauchst:</strong> Einen runden Stock (Besenstiel, dicken Stift...) und einen langen Papierstreifen</p>
      <p>âœ‚ï¸ Schneide einen Papierstreifen (ca. 2cm breit, 30cm lang)</p>
      <p>ğŸ”„ Wickle ihn eng um den Stock</p>
      <p>âœï¸ Schreibe deine Nachricht quer Ã¼ber die Windungen</p>
      <p>ğŸ Schicke den Streifen an einen Freund â€” der braucht den gleichen Stock zum Lesen!</p>
    </div>
  </div>

  <script>
    const input = document.getElementById('skytale-input') as HTMLInputElement;
    const colsSlider = document.getElementById('skytale-cols') as HTMLInputElement;
    const colsDisplay = document.getElementById('cols-display')!;
    const grid = document.getElementById('skytale-grid')!;
    const output = document.getElementById('skytale-output')!;

    colsSlider.addEventListener('input', () => { colsDisplay.textContent = colsSlider.value; });

    function encrypt(text: string, cols: number): { grid: string[][], result: string } {
      const clean = text.toUpperCase().replace(/[^A-ZÃ„Ã–ÃœÃŸ ]/g, '');
      const rows = Math.ceil(clean.length / cols);
      const padded = clean.padEnd(rows * cols, 'Â·');
      const g: string[][] = [];
      for (let r = 0; r < rows; r++) {
        g.push(padded.slice(r * cols, (r + 1) * cols).split(''));
      }
      let result = '';
      for (let c = 0; c < cols; c++) {
        for (let r = 0; r < rows; r++) {
          result += g[r][c];
        }
      }
      return { grid: g, result };
    }

    function decrypt(text: string, cols: number): { grid: string[][], result: string } {
      const clean = text.toUpperCase();
      const rows = Math.ceil(clean.length / cols);
      const padded = clean.padEnd(rows * cols, 'Â·');
      // Decrypt = encrypt with rows as cols
      const g: string[][] = [];
      for (let r = 0; r < cols; r++) {
        g.push([]);
      }
      let idx = 0;
      for (let c = 0; c < cols; c++) {
        for (let r = 0; r < rows; r++) {
          if (!g[r]) g[r] = [];
        }
      }
      // Fill column by column
      const g2: string[][] = Array.from({length: rows}, () => Array(cols).fill('Â·'));
      idx = 0;
      for (let c = 0; c < cols; c++) {
        for (let r = 0; r < rows; r++) {
          g2[r][c] = padded[idx++] || 'Â·';
        }
      }
      let result = '';
      for (let r = 0; r < rows; r++) {
        result += g2[r].join('');
      }
      return { grid: g2, result: result.replace(/Â·/g, '').trim() };
    }

    function showGrid(g: string[][], cols: number) {
      const colors = ['bg-candy-red/20', 'bg-candy-orange/20', 'bg-candy-yellow/20', 'bg-candy-green/20', 'bg-candy-blue/20', 'bg-candy-purple/20', 'bg-candy-pink/20'];
      grid.style.cssText = `display: grid; grid-template-columns: repeat(${cols}, 1fr); max-width: ${cols * 3}rem;`;
      grid.innerHTML = g.map((row, ri) =>
        row.map(c => `<div class="${colors[ri % colors.length]} rounded p-2 text-center font-mono font-bold text-lg">${c}</div>`).join('')
      ).join('');
    }

    document.getElementById('btn-encrypt-sky')!.addEventListener('click', () => {
      const cols = parseInt(colsSlider.value);
      const { grid: g, result } = encrypt(input.value, cols);
      showGrid(g, cols);
      output.textContent = result;
    });

    document.getElementById('btn-decrypt-sky')!.addEventListener('click', () => {
      const cols = parseInt(colsSlider.value);
      const { grid: g, result } = decrypt(input.value, cols);
      showGrid(g, cols);
      output.textContent = result;
    });
  </script>
</Layout>
