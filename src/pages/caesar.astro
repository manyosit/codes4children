---
import CodeLayout from '../layouts/CodeLayout.astro';
import { getCodeBySlug } from '../data/codes';
const code = getCodeBySlug('caesar')!;
const funFacts = [
  { icon: 'ğŸ›ï¸', text: '<strong class="text-white">Julius Caesar</strong> hat vor Ã¼ber 2.000 Jahren geheime Nachrichten an seine GenerÃ¤le geschickt â€” mit genau dieser Methode.' },
  { icon: 'ğŸ”¢', text: 'Caesar benutzte meist eine Verschiebung von <strong class="text-white">3</strong>. Heute wÃ¤re das in Sekunden geknackt.' },
];
---
<CodeLayout code={code} funFacts={funFacts}>
  <!-- How it works -->
  <section class="max-w-content mx-auto px-6 md:px-12 py-16">
    <div class="card-static max-w-3xl mx-auto">
      <h2 class="font-display font-bold text-2xl mb-4">So funktioniert's</h2>
      <p class="text-text-secondary mb-6">Verschiebe das Alphabet um eine bestimmte Anzahl Stellen:</p>
      <div class="bg-gray-50 rounded-xl p-5 font-mono text-sm md:text-base overflow-x-auto mb-6">
        <p><span class="text-text-secondary mr-2">Normal:</span>  A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</p>
        <p class="font-semibold" style={`color: ${code.accentColor}`}><span class="text-text-secondary mr-2 font-normal">+3:</span>     D E F G H I J K L M N O P Q R S T U V W X Y Z A B C</p>
      </div>
      <div class="rounded-xl p-6 text-center" style={`background: ${code.accentColorLight}`}>
        <p class="text-lg">
          <span class="text-text-secondary">HALLO</span>
          <span class="mx-3 text-gray-300">â†’</span>
          <span class="font-bold text-2xl" style={`color: ${code.accentColor}`}>KDOOR</span>
        </p>
      </div>
    </div>
  </section>

  <!-- Die Geschichte dahinter -->
  <section class="bg-surface-dark py-16 md:py-20">
    <div class="max-w-content mx-auto px-6 md:px-12">
      <div class="max-w-3xl mx-auto">
        <h2 class="font-display font-bold text-2xl md:text-3xl text-white text-center mb-8">ğŸ“– Die Geschichte dahinter</h2>
        <div class="bg-white/5 backdrop-blur rounded-2xl p-8 border border-white/10">
          <p class="text-gray-300 leading-relaxed mb-4">
            Stell dir vor: Du bist ein rÃ¶mischer General, mitten im Krieg. Deine Armee ist Hunderte Kilometer entfernt, und du musst deinem besten Feldherrn eine geheime Nachricht schicken. Aber Achtung â€” Ã¼berall lauern Spione des Feindes!
          </p>
          <p class="text-gray-300 leading-relaxed mb-4">
            Genau vor diesem Problem stand <strong class="text-white">Julius Caesar</strong> vor Ã¼ber 2.000 Jahren. Er war einer der mÃ¤chtigsten Herrscher des RÃ¶mischen Reiches â€” und ein genialer Stratege. Caesar wusste: Wenn seine Boten abgefangen wÃ¼rden, dÃ¼rfte der Feind die Nachricht nicht verstehen.
          </p>
          <p class="text-gray-300 leading-relaxed mb-4">
            Seine LÃ¶sung war verblÃ¼ffend einfach: Er verschob jeden Buchstaben im Alphabet um drei Stellen. Aus A wurde D, aus B wurde E, und so weiter. Seine GenerÃ¤le kannten den Trick â€” aber fÃ¼r jeden anderen sah die Nachricht aus wie sinnloses Buchstabenwirrwarr.
          </p>
          <p class="text-gray-300 leading-relaxed">
            So schickte Caesar Befehle quer durch das riesige RÃ¶mische Reich, ohne dass seine Feinde je erfuhren, was er plante. Und das Beste? Diesen genialen Trick kannst du jetzt auch benutzen! ğŸ›ï¸
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Interactive Tool -->
  <section class="py-16" style={`background: ${code.accentColor}08`}>
    <div class="max-w-3xl mx-auto px-6 md:px-12">
      <h2 class="font-display font-bold text-2xl md:text-3xl text-center mb-10">Probier's aus</h2>

      <div class="card-static p-8">
        <div class="mb-6">
          <label class="block text-sm font-semibold text-text-primary mb-2">Deine Nachricht</label>
          <input type="text" id="caesar-input" placeholder="Schreibe hier deine geheime Nachricht..."
                 class="tool-input" style={`--tw-ring-color: ${code.accentColor}30; border-color: #E2E8F0`}
                 maxlength="100" />
        </div>

        <div class="mb-8">
          <label class="block text-sm font-semibold text-text-primary mb-2">
            Verschiebung: <span id="shift-display" style={`color: ${code.accentColor}`}>3</span>
          </label>
          <input type="range" id="caesar-shift" min="1" max="25" value="3"
                 style={`accent-color: ${code.accentColor}`} />
        </div>

        <!-- Segmented Control -->
        <div class="segmented-control mb-8">
          <button id="btn-encrypt" class="active">VerschlÃ¼sseln</button>
          <button id="btn-decrypt">EntschlÃ¼sseln</button>
        </div>

        <div>
          <label class="block text-sm font-semibold text-text-primary mb-2">Ergebnis</label>
          <div id="caesar-output" class="tool-output text-xl font-semibold text-center"
               style={`background: ${code.accentColor}10; border-left: 4px solid ${code.accentColor}; color: ${code.accentColor}`}>
            â€¦
          </div>
        </div>
      </div>

      <!-- Alphabet display -->
      <div class="card-static mt-6 p-6">
        <h3 class="text-sm font-semibold text-text-secondary uppercase tracking-wider mb-4 text-center">Alphabet-Zuordnung</h3>
        <div id="alphabet-display" class="grid grid-cols-13 gap-1 max-w-2xl mx-auto"></div>
      </div>
    </div>
  </section>

  <!-- Challenge -->
  <section class="max-w-content mx-auto px-6 md:px-12 py-16">
    <div class="card-static max-w-3xl mx-auto text-center p-8">
      <h2 class="font-display font-bold text-2xl mb-4">ğŸ† Herausforderung</h2>
      <p class="text-text-secondary mb-6">EntschlÃ¼ssle diese Nachricht â€” Verschiebung ist <strong class="text-text-primary">7</strong>:</p>
      <p class="text-2xl md:text-3xl font-mono font-bold rounded-xl p-6"
         style={`color: ${code.accentColor}; background: ${code.accentColorLight}`}>
        NLKPTLU JLOLPT
      </p>
      <details class="mt-6">
        <summary class="cursor-pointer font-semibold hover:underline text-sm" style={`color: ${code.accentColor}`}>LÃ¶sung anzeigen</summary>
        <p class="mt-3 text-lg font-semibold">GEHEIME CODES ğŸ‰</p>
      </details>
    </div>
  </section>

  <script define:vars={{ accentColor: code.accentColor }}>
    const ALPHA = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const input = document.getElementById('caesar-input');
    const shift = document.getElementById('caesar-shift');
    const shiftDisplay = document.getElementById('shift-display');
    const output = document.getElementById('caesar-output');
    const alphaDisplay = document.getElementById('alphabet-display');
    const btnEncrypt = document.getElementById('btn-encrypt');
    const btnDecrypt = document.getElementById('btn-decrypt');
    let mode = 'encrypt';

    function caesarShift(text, n, decrypt = false) {
      if (decrypt) n = 26 - n;
      return text.toUpperCase().split('').map(c => {
        const i = ALPHA.indexOf(c);
        return i >= 0 ? ALPHA[(i + n) % 26] : c;
      }).join('');
    }

    function updateAlpha() {
      const n = parseInt(shift.value);
      alphaDisplay.innerHTML = ALPHA.split('').map((c, i) => {
        const shifted = ALPHA[(i + n) % 26];
        return `<div class="text-center py-1">
          <div class="text-xs font-semibold text-text-secondary">${c}</div>
          <div class="text-xs text-gray-300">â†“</div>
          <div class="text-xs font-bold" style="color:${accentColor}">${shifted}</div>
        </div>`;
      }).join('');
    }

    function doTransform() {
      const text = input.value;
      const n = parseInt(shift.value);
      const result = caesarShift(text, n, mode === 'decrypt');
      output.textContent = result || 'â€¦';
      if (result) output.classList.add('result-appear');
    }

    btnEncrypt.addEventListener('click', () => {
      mode = 'encrypt';
      btnEncrypt.classList.add('active');
      btnDecrypt.classList.remove('active');
      doTransform();
    });
    btnDecrypt.addEventListener('click', () => {
      mode = 'decrypt';
      btnDecrypt.classList.add('active');
      btnEncrypt.classList.remove('active');
      doTransform();
    });

    shift.addEventListener('input', () => {
      shiftDisplay.textContent = shift.value;
      updateAlpha();
    });

    input.addEventListener('input', doTransform);
    updateAlpha();
  </script>
</CodeLayout>
