---
import CodeLayout from '../layouts/CodeLayout.astro';
import { getCodeBySlug } from '../data/codes';
const code = getCodeBySlug('caesar')!;
const funFacts = [
  { icon: 'ğŸ›ï¸', text: '<strong class="text-white">Julius Caesar</strong> hat vor Ã¼ber 2.000 Jahren geheime Nachrichten an seine GenerÃ¤le geschickt â€” mit genau dieser Methode.' },
  { icon: 'ğŸ”¢', text: 'Caesar benutzte meist eine Verschiebung von <strong class="text-white">3</strong>. Heute wÃ¤re das in Sekunden geknackt.' },
];
---
<CodeLayout code={code} funFacts={funFacts}>
  <!-- How it works -->
  <section class="max-w-content mx-auto px-6 md:px-12 py-16">
    <div class="card-static max-w-3xl mx-auto">
      <h2 class="font-display font-bold text-2xl mb-4">So funktioniert's</h2>
      <p class="text-text-secondary mb-6">Verschiebe das Alphabet um eine bestimmte Anzahl Stellen:</p>
      <div class="bg-gray-50 rounded-xl p-5 font-mono text-sm md:text-base overflow-x-auto mb-6">
        <div class="flex gap-0">
          <div class="flex flex-col items-end mr-2 shrink-0">
            <span class="text-text-secondary text-xs leading-6">Normal:</span>
            <span class="text-text-secondary text-xs leading-6 font-normal">+3:</span>
          </div>
          {['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'].map((letter, i) => (
            <div class="flex flex-col items-center min-w-[1.4rem]">
              <span class="leading-6">{letter}</span>
              <span class="leading-6 font-semibold" style={`color: ${code.accentColor}`}>{'DEFGHIJKLMNOPQRSTUVWXYZABC'[i]}</span>
            </div>
          ))}
        </div>
      </div>
      <div class="rounded-xl p-6 text-center" style={`background: ${code.accentColorLight}`}>
        <p class="text-lg">
          <span class="text-text-secondary">HALLO</span>
          <span class="mx-3 text-gray-300">â†’</span>
          <span class="font-bold text-2xl" style={`color: ${code.accentColor}`}>KDOOR</span>
        </p>
      </div>
    </div>
  </section>

  <!-- Die Geschichte dahinter -->
  <section class="bg-surface-dark py-16 md:py-20">
    <div class="max-w-content mx-auto px-6 md:px-12">
      <div class="max-w-3xl mx-auto">
        <h2 class="font-display font-bold text-2xl md:text-3xl text-white text-center mb-8">ğŸ“– Die Geschichte dahinter</h2>
        <div class="bg-white/5 backdrop-blur rounded-2xl p-8 border border-white/10">
          <p class="text-gray-300 leading-relaxed mb-4">
            Stell dir vor: Du bist ein rÃ¶mischer General, mitten im Krieg. Deine Armee ist Hunderte Kilometer entfernt, und du musst deinem besten Feldherrn eine geheime Nachricht schicken. Aber Achtung â€” Ã¼berall lauern Spione des Feindes!
          </p>
          <p class="text-gray-300 leading-relaxed mb-4">
            Genau vor diesem Problem stand <strong class="text-white">Julius Caesar</strong> vor Ã¼ber 2.000 Jahren. Er war einer der mÃ¤chtigsten Herrscher des RÃ¶mischen Reiches â€” und ein genialer Stratege. Caesar wusste: Wenn seine Boten abgefangen wÃ¼rden, dÃ¼rfte der Feind die Nachricht nicht verstehen.
          </p>
          <p class="text-gray-300 leading-relaxed mb-4">
            Seine LÃ¶sung war verblÃ¼ffend einfach: Er verschob jeden Buchstaben im Alphabet um drei Stellen. Aus A wurde D, aus B wurde E, und so weiter. Seine GenerÃ¤le kannten den Trick â€” aber fÃ¼r jeden anderen sah die Nachricht aus wie sinnloses Buchstabenwirrwarr.
          </p>
          <p class="text-gray-300 leading-relaxed">
            So schickte Caesar Befehle quer durch das riesige RÃ¶mische Reich, ohne dass seine Feinde je erfuhren, was er plante. Und das Beste? Diesen genialen Trick kannst du jetzt auch benutzen! ğŸ›ï¸
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Interactive Tool -->
  <section class="py-16" style={`background: ${code.accentColor}08`}>
    <div class="max-w-3xl mx-auto px-6 md:px-12">
      <h2 class="font-display font-bold text-2xl md:text-3xl text-center mb-10">Probier's aus</h2>

      <div class="card-static p-8">
        <div class="mb-6">
          <label class="block text-sm font-semibold text-text-primary mb-2">Deine Nachricht</label>
          <input type="text" id="caesar-input" placeholder="Schreibe hier deine geheime Nachricht..."
                 class="tool-input" style={`--tw-ring-color: ${code.accentColor}30; border-color: #E2E8F0`}
                 maxlength="100" />
        </div>

        <div class="mb-8">
          <label class="block text-sm font-semibold text-text-primary mb-2">
            Verschiebung: <span id="shift-display" style={`color: ${code.accentColor}`}>3</span>
          </label>
          <input type="range" id="caesar-shift" min="1" max="25" value="3"
                 style={`accent-color: ${code.accentColor}`} />
        </div>

        <!-- Segmented Control -->
        <div class="segmented-control mb-8">
          <button id="btn-encrypt" class="active">VerschlÃ¼sseln</button>
          <button id="btn-decrypt">EntschlÃ¼sseln</button>
        </div>

        <div>
          <label class="block text-sm font-semibold text-text-primary mb-2">Ergebnis</label>
          <div id="caesar-output" class="tool-output text-xl font-semibold text-center"
               style={`background: ${code.accentColor}10; border-left: 4px solid ${code.accentColor}; color: ${code.accentColor}`}>
            â€¦
          </div>
        </div>
      </div>

      <!-- Alphabet display -->
      <div class="card-static mt-6 p-6" id="print-area">
        <h3 class="text-sm font-semibold text-text-secondary uppercase tracking-wider mb-2 text-center">Alphabet-Zuordnung</h3>
        <p class="text-sm text-text-secondary text-center mb-4">ğŸ”‘ Stelle oben deinen SchlÃ¼ssel ein und drucke dir diese Karten aus â€” so kannst du mit deinen Freunden geheime Nachrichten ver- und entschlÃ¼sseln!</p>
        <div id="alphabet-display" class="grid grid-cols-6 sm:grid-cols-9 md:grid-cols-13 gap-2 max-w-2xl mx-auto"></div>
        <div class="text-center mt-5 print:hidden">
          <button id="btn-print" class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-semibold text-white transition-all hover:-translate-y-0.5 hover:shadow-md" style={`background: ${code.accentColor}`}>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6"/><rect x="6" y="14" width="12" height="8" rx="1"/></svg>
            Karten ausdrucken
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Challenge -->
  <section class="max-w-content mx-auto px-6 md:px-12 py-16">
    <div class="card-static max-w-3xl mx-auto text-center p-8">
      <h2 class="font-display font-bold text-2xl mb-4">ğŸ† Herausforderung</h2>
      <p class="text-text-secondary mb-6">EntschlÃ¼ssle diese Nachricht â€” Verschiebung ist <strong class="text-text-primary">7</strong>:</p>
      <p class="text-2xl md:text-3xl font-mono font-bold rounded-xl p-6"
         style={`color: ${code.accentColor}; background: ${code.accentColorLight}`}>
        NLKPTLU JLOLPT
      </p>
      <details class="mt-6">
        <summary class="cursor-pointer font-semibold hover:underline text-sm" style={`color: ${code.accentColor}`}>LÃ¶sung anzeigen</summary>
        <p class="mt-3 text-lg font-semibold">GEHEIME CODES ğŸ‰</p>
      </details>
    </div>
  </section>

  <script define:vars={{ accentColor: code.accentColor }}>
    const ALPHA = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const input = document.getElementById('caesar-input');
    const shift = document.getElementById('caesar-shift');
    const shiftDisplay = document.getElementById('shift-display');
    const output = document.getElementById('caesar-output');
    const alphaDisplay = document.getElementById('alphabet-display');
    const btnEncrypt = document.getElementById('btn-encrypt');
    const btnDecrypt = document.getElementById('btn-decrypt');
    let mode = 'encrypt';

    function caesarShift(text, n, decrypt = false) {
      if (decrypt) n = 26 - n;
      return text.toUpperCase().split('').map(c => {
        const i = ALPHA.indexOf(c);
        return i >= 0 ? ALPHA[(i + n) % 26] : c;
      }).join('');
    }

    function updateAlpha() {
      const n = parseInt(shift.value);
      alphaDisplay.innerHTML = ALPHA.split('').map((c, i) => {
        const shifted = ALPHA[(i + n) % 26];
        return `<div class="bg-white rounded-lg shadow-sm border border-gray-100 p-2 text-center">
          <div class="text-sm font-bold text-text-primary">${c}</div>
          <div class="text-[10px] text-gray-300 leading-tight">â†“</div>
          <div class="text-sm font-bold" style="color:${accentColor}">${shifted}</div>
        </div>`;
      }).join('');
    }

    function doTransform() {
      const text = input.value;
      const n = parseInt(shift.value);
      const result = caesarShift(text, n, mode === 'decrypt');
      output.textContent = result || 'â€¦';
      if (result) output.classList.add('result-appear');
    }

    btnEncrypt.addEventListener('click', () => {
      mode = 'encrypt';
      btnEncrypt.classList.add('active');
      btnDecrypt.classList.remove('active');
      doTransform();
    });
    btnDecrypt.addEventListener('click', () => {
      mode = 'decrypt';
      btnDecrypt.classList.add('active');
      btnEncrypt.classList.remove('active');
      doTransform();
    });

    shift.addEventListener('input', () => {
      shiftDisplay.textContent = shift.value;
      updateAlpha();
    });

    input.addEventListener('input', doTransform);
    updateAlpha();

    document.getElementById('btn-print').addEventListener('click', () => {
      const printArea = document.getElementById('print-area');
      const w = window.open('', '_blank');
      w.document.write(`<!DOCTYPE html><html><head><title>Caesar-Chiffre SchlÃ¼ssel</title><style>
        body { font-family: Inter, system-ui, sans-serif; padding: 20px; }
        h2 { text-align: center; margin-bottom: 4px; }
        p { text-align: center; color: #64748B; font-size: 13px; margin-bottom: 16px; }
        .grid { display: grid; grid-template-columns: repeat(13, 1fr); gap: 8px; max-width: 600px; margin: 0 auto; }
        .card { border: 1.5px solid #E2E8F0; border-radius: 8px; padding: 8px 4px; text-align: center; }
        .orig { font-weight: 700; font-size: 16px; }
        .arrow { color: #cbd5e1; font-size: 10px; }
        .shifted { font-weight: 700; font-size: 16px; color: ${accentColor}; }
      </style></head><body>
        <h2>ğŸ”‘ Caesar-Chiffre â€” SchlÃ¼ssel ${shift.value}</h2>
        <p>Schneide die Karten aus und teile sie mit deinen Freunden!</p>
        <div class="grid">${
          'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').map((c, i) => {
            const s = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[(i + parseInt(shift.value)) % 26];
            return '<div class="card"><div class="orig">'+c+'</div><div class="arrow">â†“</div><div class="shifted">'+s+'</div></div>';
          }).join('')
        }</div></body></html>`);
      w.document.close();
      w.print();
    });
  </script>
</CodeLayout>
