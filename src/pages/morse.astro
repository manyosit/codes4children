---
import Layout from '../layouts/Layout.astro';
---
<Layout title="Morse-Code" emoji="ğŸ“¡">
  <section class="section text-center max-w-3xl mx-auto px-6 pb-12">
    <div class="text-6xl mb-6 animate-fade-in">ğŸ“¡</div>
    <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-4">
      <span class="gradient-text">Morse-Code</span>
    </h1>
    <p class="text-lg text-gray-500 max-w-xl mx-auto">
      Punkte und Striche â€” damit wurde Ã¼ber riesige Entfernungen kommuniziert. Per Funk, Lichtsignal oder Klopfzeichen.
    </p>
  </section>

  <!-- Morse Alphabet -->
  <section class="max-w-4xl mx-auto px-6 mb-16">
    <div class="card">
      <h2 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-6 text-center">Das Morse-Alphabet</h2>
      <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-9 gap-2" id="morse-table"></div>
      <p class="text-center text-sm text-gray-400 mt-4">â— = kurz (dit) &nbsp;&nbsp; â” = lang (dah)</p>
    </div>
  </section>

  <!-- Tool -->
  <section class="bg-pastel-gray py-16">
    <div class="max-w-3xl mx-auto px-6">
      <h2 class="text-2xl md:text-3xl font-bold text-center mb-10">Morse-Ãœbersetzer</h2>
      <div class="bg-white rounded-3xl p-8 shadow-soft">
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Dein Text</label>
          <input type="text" id="morse-input" placeholder="Schreibe hier..." class="tool-input" maxlength="50" />
        </div>
        <div class="flex gap-3 mb-8 flex-wrap">
          <button id="btn-to-morse" class="btn btn-blue">Ãœbersetzen</button>
          <button id="btn-play-morse" class="btn btn-green">â–¶ Abspielen</button>
          <button id="btn-flash-morse" class="btn btn-orange">ğŸ’¡ Blinken</button>
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Morse-Code</label>
          <div id="morse-output" class="tool-output text-xl font-mono text-apple-blue text-center tracking-widest">â€¦</div>
        </div>
        <div id="flash-area" class="hidden mt-6 rounded-2xl h-28 flex items-center justify-center text-3xl font-semibold transition-all duration-100"
             style="background: #1D1D1F; color: white;">ğŸ’¡</div>
      </div>
    </div>
  </section>

  <!-- SOS -->
  <section class="section max-w-3xl mx-auto px-6">
    <div class="card text-center">
      <h2 class="text-2xl font-bold mb-3">ğŸ†˜ Das berÃ¼hmteste Signal</h2>
      <p class="text-gray-500 mb-6">SOS â€” das internationale Notsignal. Super einfach zu merken:</p>
      <div class="bg-pastel-blue rounded-2xl p-6 mb-4">
        <p class="text-3xl font-mono font-bold tracking-widest text-apple-blue">â— â— â—&nbsp;&nbsp;â” â” â”&nbsp;&nbsp;â— â— â—</p>
        <p class="text-sm text-gray-500 mt-2">drei kurz â€” drei lang â€” drei kurz</p>
      </div>
      <p class="text-sm text-gray-400">
        Du kannst SOS mit einer Taschenlampe signalisieren: 3Ã— kurz blinken, 3Ã— lang, 3Ã— kurz.
      </p>
    </div>
  </section>

  <script>
    const MORSE: Record<string, string> = {
      'A':'.-','B':'-...','C':'-.-.','D':'-..','E':'.','F':'..-.','G':'--.','H':'....','I':'..','J':'.---',
      'K':'-.-','L':'.-..','M':'--','N':'-.','O':'---','P':'.--.','Q':'--.-','R':'.-.','S':'...','T':'-',
      'U':'..-','V':'...-','W':'.--','X':'-..-','Y':'-.--','Z':'--..','0':'-----','1':'.----','2':'..---',
      '3':'...--','4':'....-','5':'.....','6':'-....','7':'--...','8':'---..','9':'----.'
    };

    const table = document.getElementById('morse-table')!;
    Object.entries(MORSE).forEach(([letter, code]) => {
      const visual = code.replace(/\./g, 'â—').replace(/-/g, 'â”');
      table.innerHTML += `<div class="bg-pastel-blue rounded-xl p-3 text-center">
        <div class="text-lg font-bold text-gray-800">${letter}</div>
        <div class="text-sm tracking-wider text-apple-blue font-mono">${visual}</div>
      </div>`;
    });

    function textToMorse(text: string): string {
      return text.toUpperCase().split('').map(c => {
        if (c === ' ') return ' / ';
        const m = MORSE[c];
        return m ? m.replace(/\./g, 'â—').replace(/-/g, 'â”') : '';
      }).join(' ');
    }

    function textToMorseRaw(text: string): string {
      return text.toUpperCase().split('').map(c => {
        if (c === ' ') return '/';
        return MORSE[c] || '';
      }).join(' ');
    }

    const input = document.getElementById('morse-input') as HTMLInputElement;
    const output = document.getElementById('morse-output')!;

    document.getElementById('btn-to-morse')!.addEventListener('click', () => {
      output.textContent = textToMorse(input.value) || 'â€¦';
    });

    document.getElementById('btn-play-morse')!.addEventListener('click', async () => {
      const raw = textToMorseRaw(input.value);
      if (!raw) return;
      const ctx = new AudioContext();
      let time = ctx.currentTime;
      const dot = 0.1, dash = 0.3, gap = 0.1, letterGap = 0.3, wordGap = 0.7;
      for (const char of raw) {
        if (char === '.' || char === '-') {
          const osc = ctx.createOscillator();
          osc.connect(ctx.destination);
          osc.frequency.value = 600;
          osc.start(time);
          osc.stop(time + (char === '.' ? dot : dash));
          time += (char === '.' ? dot : dash) + gap;
        } else if (char === '/') { time += wordGap; }
        else if (char === ' ') { time += letterGap; }
      }
    });

    document.getElementById('btn-flash-morse')!.addEventListener('click', async () => {
      const raw = textToMorseRaw(input.value);
      if (!raw) return;
      const flash = document.getElementById('flash-area')!;
      flash.classList.remove('hidden');
      const dot = 150, dash = 450, gap = 150, letterGap = 350, wordGap = 700;
      for (const char of raw) {
        if (char === '.' || char === '-') {
          flash.style.background = '#FFCC00';
          flash.textContent = 'âœ¨';
          await new Promise(r => setTimeout(r, char === '.' ? dot : dash));
          flash.style.background = '#1D1D1F';
          flash.textContent = 'ğŸ’¡';
          await new Promise(r => setTimeout(r, gap));
        } else if (char === '/') { await new Promise(r => setTimeout(r, wordGap)); }
        else if (char === ' ') { await new Promise(r => setTimeout(r, letterGap)); }
      }
    });
  </script>
</Layout>
